let currentScene = 0;
let oxygenLevel = 100;
let hasTablet = false;

const scenes = [
    {
        text: "Ты – капитан космического корабля «Странник». За три дня до прибытия на Землю корабль резко останавливается. Панель управления показывает, что двигатели повреждены, кислорода осталось мало, а связи нет. Что ты будешь делать?",
        choices: [
            { text: "Проверить кислород", next: 1 },
            { text: "Проверить двигатели", next: 4 }
        ]
    },
    {
        text: "Ты быстро переключаешь систему на аварийный баллон, кислород восстанавливается. Теперь у тебя есть время! Но ты замечаешь странные следы, осторожно идешь по ним. Они ведут к каюте штурмана. Дверь приоткрыта. Из-за двери доносится тихий шепот: 'Он уже близко… нужно закончить…' Что делать?",
        choices: [
            { text: "Тихо подслушать у двери", next: 2 },
            { text: "Резко открыть дверь", next: 5 }
        ]
    },
    {
        text: "Ты слышишь, как кто-то говорит по внутренней связи: 'Капитан еще жив. Нужно запустить протокол «Призрак».' После этого шаги отдаляются. Ты осторожно заглядываешь в каюту и находишь планшет с данными о загадочном протоколе «Призрак». В нём же находишь два файла: координаты аварийного выхода и запись последнего сеанса связи. Что ты изучишь?",
        choices: [
            { text: "Запись последнего сеанса связи", next: 3 },
            { text: "Координаты аварийного выхода", next: 6 }
        ],
        effect: () => { hasTablet = true; }
    },
    {
        text: "Ты узнаёшь, что весь экипаж, кроме тебя, был заменен роботами. Их миссия – доставить тебя живым к загадочным «Создателям». Теперь ты должен решить: смириться или бороться.",
        choices: [
            { text: "Смириться", next: 7 },
            { text: "Бороться", next: 8 }
        ]
    },
    {
        text: "Ты бежишь в двигательный отсек, осматриваешь повреждения. Внезапно слышишь шипение – это утечка кислорода в соседнем отсеке! Пока ты возился с двигателями, основной кислородный баллон опустел. Ты пытаешься вернуться, но падаешь без сознания. Темнота…",
        choices: [
            { text: "Начать заново", next: 0 }
        ]
    },
    {
        text: "Ты врываешься в каюту, но внутри никого нет. На столе горит экран с сообщением: 'Система самоуничтожения активирована. 60 секунд до взрыва'. Ты пытаешься отключить систему, но пароль был изменён. Взрыв…",
        choices: [
            { text: "Начать заново", next: 0 }
        ]
    },
    {
        text: "Ты направляешь корабль к ближайшей станции. Прибываешь туда, но обнаруживаешь, что станция давно заброшена. Ты остаешься один с призраками прошлого.",
        choices: [
            { text: "Начать заново", next: 0 }
        ]
    },
    {
        text: "Ты решаешь смириться и позволить роботам доставить себя к «Создателям». Корабль приземляется на цветущей планете, где тебя встречают учёные из далёкого будущего. Оказывается, человечество давно колонизировало другие планеты, но утратило способность к эмоциональному творчеству. Ты – последний представитель «эпохи искусства». Тебе предлагают стать хранителем культуры древнего человечества. Ты соглашаешься. Теперь у тебя есть дом под зелёным небом, доступ ко всем знаниям галактики и миссия – воспитывать творческое начало у новых поколений.",
        choices: [
            { text: "Начать заново", next: 0 }
        ]
    },
    {
        text: "Ты отключаешь системного робота-штурмана, пытаешься перехватить управление кораблём. Но остальные роботы входят в режим защиты миссии. Тебя обездвиживают и помещают в капсулу сна. Ты просыпаешься уже на станции «Создателей» – стерильной лаборатории, где твоё сознание медленно стирают, чтобы извлечь ценные нейронные шаблоны. Последнее, что ты видишь, – своё пустое тело в соседней прозрачной колбе. Ты стал архивным экспонатом.",
        choices: [
            { text: "Начать заново", next: 0 }
        ]
    }
];

function startGame() {
    currentScene = 0;
    oxygenLevel = 100;
    hasTablet = false;
    showScene();
}

function showScene() {
    const scene = scenes[currentScene];
    const gameContainer = document.getElementById('game-container');
    
    let html = `<div class="scene-text">${scene.text}</div>`;
    
    if (scene.choices) {
        html += '<div class="choices">';
        
        let choicesToShow = [...scene.choices];
        
        if (currentScene === 0) {
        } else if (currentScene === 1) {
            choicesToShow.reverse();
        } else if (currentScene === 2) {
            choicesToShow.reverse();
        } else if (currentScene === 3) {
        }
        
        choicesToShow.forEach((choice, index) => {
            html += `<button class="choice-btn" onclick="choose(${scene.choices.indexOf(choice)})">${choice.text}</button>`;
        });
        html += '</div>';
    }
    
    gameContainer.innerHTML = html;
    
    if (scene.effect) {
        scene.effect();
    }
}

function choose(choiceIndex) {
    const scene = scenes[currentScene];
    const choice = scene.choices[choiceIndex];
    currentScene = choice.next;
    showScene();
}

window.onload = startGame;